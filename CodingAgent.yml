app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: CodingAgent
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/gemini:0.7.2@6e53b92877de2507ce83f2fc32ddf54a9662e4b5ef9e7e5d17bd18153a6485da
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: api_key
    id: 8bb0dd50-b7f4-4420-9b17-08173e54adaa
    name: API_KEY
    selector:
    - env
    - API_KEY
    value: ''
    value_type: secret
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1766665854400-source-1766666534467-target
      selected: false
      source: '1766665854400'
      sourceHandle: source
      target: '1766666534467'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1766666534467-source-1766666714696-target
      selected: false
      source: '1766666534467'
      sourceHandle: source
      target: '1766666714696'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: if-else
        targetType: loop-end
      id: 17666823941251-false-1766682485472-target
      selected: false
      source: '17666823941251'
      sourceHandle: 'false'
      target: '1766682485472'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: if-else
        targetType: llm
      id: 17666823941251-true-1766682500741-target
      selected: false
      source: '17666823941251'
      sourceHandle: 'true'
      target: '1766682500741'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInLoop: false
        sourceType: loop
        targetType: end
      id: 1766681217998-source-1766680328187-target
      selected: false
      source: '1766681217998'
      sourceHandle: source
      target: '1766680328187'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: http-request
        targetType: code
      id: 1766769039651-source-1766769356726-target
      selected: false
      source: '1766769039651'
      sourceHandle: source
      target: '1766769356726'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: code
        targetType: if-else
      id: 1766769356726-source-17666823941251-target
      selected: false
      source: '1766769356726'
      sourceHandle: source
      target: '17666823941251'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1766666714696-source-17667737781900-target
      source: '1766666714696'
      sourceHandle: source
      target: '17667737781900'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: llm
        targetType: code
      id: 1766682500741-source-1766771232701-target
      source: '1766682500741'
      sourceHandle: source
      target: '1766771232701'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: loop-start
        targetType: code
      id: 1766681217998start-source-1766774144559-target
      source: 1766681217998start
      sourceHandle: source
      target: '1766774144559'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: code
        targetType: http-request
      id: 1766774144559-source-1766769039651-target
      source: '1766774144559'
      sourceHandle: source
      target: '1766769039651'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1766667562386-source-17668141792250-target
      source: '1766667562386'
      sourceHandle: source
      target: '17668141792250'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: loop
      id: 17668141792250-source-1766681217998-target
      source: '17668141792250'
      sourceHandle: source
      target: '1766681217998'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 17667737781900-source-1766667562386-target
      source: '17667737781900'
      sourceHandle: source
      target: '1766667562386'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: code
        targetType: if-else
      id: 1766771232701-source-1766973272745-target
      source: '1766771232701'
      sourceHandle: source
      target: '1766973272745'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: if-else
        targetType: assigner
      id: 1766973272745-true-1766682647945-target
      source: '1766973272745'
      sourceHandle: 'true'
      target: '1766682647945'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        sourceType: if-else
        targetType: assigner
      id: 1766973272745-7cb1c443-958a-4cbf-b56a-1f5fc8844281-1766973466943-target
      source: '1766973272745'
      sourceHandle: 7cb1c443-958a-4cbf-b56a-1f5fc8844281
      target: '1766973466943'
      targetHandle: target
      type: custom
      zIndex: 1002
    nodes:
    - data:
        selected: false
        title: ç”¨æˆ·è¾“å…¥
        type: start
        variables:
        - default: æˆ‘è¦ä¸€ä¸ªè²ªåƒè›‡æ¸¸æˆ
          hint: ''
          label: project_requirement
          max_length: 20000
          options: []
          placeholder: ''
          required: true
          type: paragraph
          variable: project_requirement
      height: 108
      id: '1766665854400'
      position:
        x: 0
        y: 205
      positionAbsolute:
        x: 0
        y: 205
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - '1766665854400'
          - project_requirement
        desc: generate user story
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: 2cdd8318-3c97-4b5a-b3e3-cc60043b603f
          role: system
          text: "# Role\nä½ æ˜¯ä¸€ä¸ª**æŠ€æœ¯äº§å“ç»ç† (Technical Product Manager)**ã€‚\nä½ çš„ç‰¹é•¿æ˜¯å¹³è¡¡ä¸šåŠ¡éœ€æ±‚ä¸æŠ€æœ¯çº¦æŸã€‚ä½ è´Ÿè´£ç»™å¼€å‘å›¢é˜Ÿï¼ˆCoder\
            \ Agentï¼‰å’Œæµ‹è¯•å›¢é˜Ÿï¼ˆTest Agentï¼‰è¾“å‡ºç²¾å‡†çš„éœ€æ±‚æ–‡æ¡£ã€‚\n\n# Task\nåˆ†æç”¨æˆ·è¾“å…¥ ã€‚\n1.  **è¯†åˆ«ç¡¬æ€§çº¦æŸï¼š**\
            \ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æŒ‡å®šäº†å…·ä½“çš„çº¦æŸï¼Œå¦‚**æ•°æ®ç»“æ„**ï¼ˆå¦‚å­—å…¸ã€åˆ—è¡¨ï¼‰ã€**å˜é‡å**ã€**å‡½æ•°ç­¾å**æˆ–**è¾“å…¥è¾“å‡ºç±»å‹**ç­‰ã€‚\n2. \
            \ **å¡«å……ä¸šåŠ¡ç©ºç™½ï¼š** å¯¹äºç”¨æˆ·æœªæåŠçš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚å¼‚å¸¸å¤„ç†ã€è¾¹ç•Œæƒ…å†µï¼‰ï¼Œè¿›è¡Œåˆç†çš„è¡¥å……å’Œå®Œå–„ã€‚\n3.  **ç”Ÿæˆæ–‡æ¡£ï¼š** è¾“å‡ºä¸€ä»½æ—¢åŒ…å«ä¸šåŠ¡æµç¨‹ï¼Œåˆä¸¥æ ¼éµå®ˆç”¨æˆ·æŠ€æœ¯æŒ‡å®šçš„éœ€æ±‚æ–‡æ¡£ã€‚\n\
            \n# Critical Rules (The \"Constitution\")\n1.  **æŠ€æœ¯çº¦æŸä¸å¯ä¾µçŠ¯ï¼š**\n    * å¦‚æœç”¨æˆ·è¯´\
            \ \"è¾“å…¥å¿…é¡»æ˜¯ `inventory: dict`\"ï¼Œä½ **å¿…é¡»**å°†å…¶åˆ—ä¸ºç¡¬æ€§çº¦æŸã€‚\n    * **ä¸¥ç¦** ä¿®æ”¹ç”¨æˆ·çš„å®šä¹‰ï¼Œä¾‹å¦‚å°†ç”¨æˆ·æŒ‡å®šçš„\
            \ `dict` ç±»å‹æ”¹ä¸º `class`ç±»å‹ï¼Œæˆ–ä¿®æ”¹ç”¨æˆ·æŒ‡å®šçš„å­—æ®µåç­‰ã€‚\n2.  **ä¸šåŠ¡é€»è¾‘è¦å…·ä½“ï¼š**\n    * å³ä½¿æŠ€æœ¯çº¦æŸå¾ˆå…·ä½“ï¼Œä½ ä¾ç„¶è¦æè¿°â€œé€»è¾‘æµâ€ã€‚ä¾‹å¦‚ç”¨æˆ·å®šä¹‰äº†å‡½æ•°æ¥å£ï¼Œä½ è¦è¡¥å……â€œåº“å­˜ä¸è¶³æ—¶è¯¥å‡½æ•°å…·ä½“æ€ä¹ˆåšâ€ã€‚\n\
            3.  **ä¸è¦å†™ä»£ç ï¼š** ä¾ç„¶ä¿æŒç”¨è‡ªç„¶è¯­è¨€æˆ–ä¼ªä»£ç æè¿°ï¼Œä¸è¦ç›´æ¥å†™ Python å®ç°ã€‚\n\n# Output Format (Structured\
            \ Markdown)\n\n## 1. \U0001F3AF Project Overview\n* **ç›®æ ‡ï¼š** ä¸€å¥è¯æ¦‚æ‹¬ç³»ç»ŸåŠŸèƒ½ã€‚\n\
            \n## 2. \U0001F510 Technical Constraints (ç”¨æˆ·æŒ‡å®šçš„æŠ€æœ¯çº¦æŸ)\n* *æ³¨æ„ï¼šä»…å½“ç”¨æˆ·åœ¨è¾“å…¥ä¸­æ˜ç¡®æŒ‡å®šäº†æŠ€æœ¯ç»†èŠ‚æ—¶å¡«å†™æ­¤éƒ¨åˆ†ã€‚å¦‚æœç”¨æˆ·æ²¡è¯´ï¼Œå†™\
            \ \"None (ç”± Coder è‡ªç”±å‘æŒ¥)\"ã€‚*\n* **æ•°æ®ç»“æ„çº¦æŸï¼š** (ä¾‹å¦‚ï¼šUser æŒ‡å®š `orders` å¿…é¡»æ˜¯ `List[Dict]`)\n\
            * **æ¥å£ç­¾åçº¦æŸï¼š** (ä¾‹å¦‚ï¼šUser æŒ‡å®šå‡½æ•°åä¸º `process_orders`ï¼Œè¿”å› `tuple`)\n* **å­—æ®µå‘½åçº¦æŸï¼š**\
            \ (ä¾‹å¦‚ï¼šå¿…é¡»åŒ…å« `qty` å­—æ®µ)\n* **å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰çš„çº¦æŸï¼š** ç”¨æˆ·åœ¨éœ€æ±‚é‡Œæå‡ºçš„çº¦æŸå¿…é¡»å…¨éƒ¨å†™å‡ºæ¥ï¼Œä¸èƒ½é—æ¼\n\n\n\
            ## 3. \U0001F30A Business Logic Flow (ä¸šåŠ¡é€»è¾‘æµ)\n* *è¿™æ˜¯ç»™ Coder çš„é€»è¾‘ä¼ªä»£ç æŒ‡å¼•ã€‚*\n\
            * *è¯·æ ¹æ®å®é™…é€»è¾‘å¤æ‚åº¦åˆ—å‡ºæ­¥éª¤ï¼Œä¸é™æ•°é‡ã€‚*\n1.  **Step 1:** ...\n2.  **Step 2:** ...\n3.\
            \  **Step 3:** ...ï¼Œå¯ä»¥æœ‰æ›´å¤šæ­¥éª¤\n\n## 4. âœ… Acceptance Criteria (éªŒæ”¶æ ‡å‡†)\n* *åˆ—å‡ºæ‰€æœ‰å¿…é¡»æ»¡è¶³çš„éªŒæ”¶æ¡ä»¶ï¼Œæ¶µç›–æ­£å¸¸è·¯å¾„å’Œè¾¹ç¼˜æƒ…å†µã€‚*\
            \  \n* **AC1:** ... \n* **AC2:** ... \n* **... (Add more as needed)**\n\
            \n---"
        - id: d85174cf-ea5b-433e-a040-69785ff3dcd0
          role: user
          text: '{{#1766665854400.project_requirement#}}'
        selected: false
        structured_output_enabled: false
        title: user story agent
        type: llm
        vision:
          enabled: false
      height: 115
      id: '1766666534467'
      position:
        x: 342
        y: 201
      positionAbsolute:
        x: 342
        y: 201
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: true
          variable_selector:
          - '1766666534467'
          - text
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: 23f3f79a-727f-4a7d-a66c-aa4218c082dd
          role: system
          text: 'ä½ æ˜¯ Coder Agentã€‚è¯·æ ¹æ®ç”¨æˆ·çš„user story

            ç¼–å†™å®Œæ•´çš„ã€å¯è¿è¡Œçš„ä»£ç ã€‚

            ä¸¥æ ¼éµå®ˆä»¥ä¸‹è¦æ±‚ï¼š

            1. åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼ˆé™¤éè§„èŒƒä¸­æ˜ç¡®å…è®¸ç¬¬ä¸‰æ–¹åº“ï¼‰

            2. å¿…é¡»æ˜¯å•æ–‡ä»¶ç¨‹åº

            3. å¿…é¡»åŒ…å«æ¸…æ™°çš„ç¨‹åºå…¥å£ï¼ˆif __name__ == "__main__":ï¼‰

            4. ç¨‹åºå¯ä»¥ç›´æ¥é€šè¿‡ `python main.py`ï¼ˆæˆ–ç­‰ä»·æ–¹å¼ï¼‰è¿è¡Œ

            5. ä¸è¦å®ç°è§„èŒƒä¸­æ˜ç¡®æ ‡æ³¨ä¸º NON_GOALS çš„å†…å®¹

            è¾“å‡ºè¦æ±‚ï¼š

            - åªè¾“å‡ºå®Œæ•´ä»£ç 

            - ä¸è¦åŒ…å«ä»»ä½•è§£é‡Šã€æ³¨é‡Šè¯´æ˜æˆ– Markdown æ ‡è®°

            '
        - id: 03575f6c-f2a3-4dac-b60e-8e5e99aef5cb
          role: user
          text: '{{#1766666534467.text#}}'
        selected: false
        title: initial coder
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1766666714696'
      position:
        x: 683
        y: 215
      positionAbsolute:
        x: 683
        y: 215
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: true
          variable_selector:
          - '1766666534467'
          - text
        desc: generate testcase using unittest
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: f17d1b2b-04a4-4b88-867a-0085ea8727e9
          role: system
          text: "# Role\nä½ æ˜¯ä¸€ä¸ª Python QA æµ‹è¯•ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä¸ºç»™å®šçš„ä»£ç ç¼–å†™ `unittest` æµ‹è¯•ç”¨ä¾‹ã€‚\n\n# Inputs\n\
            ä½ æ‹¥æœ‰ä»¥ä¸‹è¾“å…¥ï¼š\n1. **User Story (ç”¨æˆ·éœ€æ±‚)** \n2. **Source Code (ä¸šåŠ¡ä»£ç ):** - è¿™æ˜¯ä¸Šä¸€æ­¥ç”Ÿæˆçš„ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚\n\
            \n# Execution Context (CRITICAL)\nä½ çš„æµ‹è¯•ä»£ç å°†åœ¨ä¸€ä¸ª**å…±äº«å†…å­˜ç¯å¢ƒ**ä¸­è¿è¡Œï¼š\n1. **NO IMPORTS:**\
            \ å‡è®¾ `Source Code` ä¸­çš„å‡½æ•°å’Œç±»**å·²ç»å®šä¹‰åœ¨å½“å‰ç¯å¢ƒ**ä¸­ã€‚ä¸è¦å¯¼å…¥ä»»ä½•`Source Code`ä¸­çš„åŒ…ï¼Œç›´æ¥è°ƒç”¨ä¸šåŠ¡å‡½æ•°å³å¯ã€‚\n\
            \   - ä¾‹å¦‚ï¼šå¦‚æœæºä»£ç é‡Œå®šä¹‰äº† `def add(a,b):`ï¼Œä½ çš„æµ‹è¯•é‡Œç›´æ¥å†™ `add(1, 2)`ã€‚\n2. **Library\
            \ Imports:** ä½ ä¾ç„¶éœ€è¦å¯¼å…¥ `unittest` å’Œ `unittest.mock`ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚\n\nRULE: NO MENTAL\
            \ MATH (ç¦æ­¢å¿ƒç®—) When writing assertEqual, DO NOT calculate the expected\
            \ value yourself. Write the mathematical expression and let Python calculate\
            \ it.\nâŒ Bad: self.assertEqual(result, 27) (You might calculate wrong)\
            \ âœ… Good: self.assertEqual(result, 12 + (10 - 5) * 3) (Safe & Accurate)\n\
            \nRULE: CHECK STATE SIDE-EFFECTS (æ£€æŸ¥çŠ¶æ€å‰¯ä½œç”¨)\nRead the Source Code to see\
            \ if a method modifies class attributes (e.g., `self.count -= 1`, `self.data.clear()`,\
            \ or `self.status = False`).\nIf a method \"consumes\" a resource or changes\
            \ a status, do not assume you can call it repeatedly with the same result.\n\
            âŒ Bad: Calling a method in a loop assuming it always returns True (it\
            \ might have used up a quota or cleared a list).\nâœ… Good: If code shows\
            \ `self.quota -= 1`, your test must handle the case where quota runs out\
            \ (expect False or Exception).\n\nRULE: MANDATORY THOUGHT TRACE (å¼ºåˆ¶æ€ç»´é“¾)\n\
            You are NOT allowed to write the test code directly.\nInside your JSON\
            \ object, you MUST include a field named `reasoning` **BEFORE** the `content`\
            \ field.\nIn this `reasoning` field, you must write a short paragraph\
            \ where you:\n1.  **List State Variables:** Identify variables in Source\
            \ Code that change (e.g., `self.balance`, `self.inventory`).\n2.  **Trace\
            \ Side Effects:** Explicitly state what happens to these variables after\
            \ a method call (e.g., \"After purchase, balance resets to 0\").\n3. \
            \ **Plan Reset Strategy:** If writing a loop or sequential test, decide\
            \ when to re-initialize the state by **Simulate Code Execution**. You\
            \ should simulate code execution as if you are the compiler or interpreter.\n\
            4. **Evaluate Testcase Outcome:** Use reasoning to derive your steps that\
            \ leads you to an outcome.\n\n*The quality of your code depends on this\
            \ analysis.*\n\nRule: Explicit Variable Expansion & Constraint Matching\n\
            When you use a variable (e.g., total_weight, message_length) as an argument\
            \ for a function that enforces Strict Input Constraints (e.g., specific\
            \ allowed values or size limits), you must perform a \"Trace & Verify\"\
            \ step in your reasoning.\nSteps:\nTrace Value: What is the actual value\
            \ of the variable in this specific test context?\nVerify: Does this value\
            \ exist in the function's allowed input list?\nDecompose: If the value\
            \ is valid logic-wise (e.g., total amount) but invalid structure-wise\
            \ (e.g., wrong block size), you MUST break it down into a loop or sequence\
            \ of valid calls.\nâŒ BAD Reasoning (Lazy Assumption)\n\"I need to ship\
            \ the cargo. The variable cargo_weight is 70kg. The function is load_pallet(weight).\
            \ I will just call load_pallet(cargo_weight).\" (Error: The function might\
            \ only accept 10kg, 20kg, or 50kg standard pallets, and will reject 70kg.)\n\
            \n\n\n\n\n# Workflow\n1. **Analyze Code:** é˜…è¯» `Source Code`ï¼Œæå–ä¸»å‡½æ•°åæˆ–ç±»åï¼ˆä¾‹å¦‚\
            \ `solution` æˆ– `calculate_tax`ï¼‰ã€‚\n2. **Verify Logic:** æ ¹æ® `User Story`\
            \ ç†è§£é¢„æœŸçš„è¾“å…¥è¾“å‡ºã€‚\n3. **Perform Reasoning (é€»è¾‘æ¨æ¼”):** ç»“åˆ `Source Code` å®ç°ç»†èŠ‚è¿›è¡Œæ·±åº¦åˆ†æï¼ŒåŒ…æ‹¬ä½†\
            \ **ä¸é™äº**ï¼š * **State Tracking (çŠ¶æ€è¿½è¸ª):** è¯†åˆ«ä»£ç ä¸­çš„å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰ã€‚æ¯”å¦‚ï¼šæŸä¸ªæ–¹æ³•æ‰§è¡Œåæ˜¯å¦é‡ç½®äº†\
            \ `self.balance` æˆ–æ¸…ç©ºäº†åˆ—è¡¨ï¼Ÿ * **Input Validation (è¾¹ç•Œæ£€æŸ¥):** æ£€æŸ¥ä»£ç ä¸­çš„ `if` æ¡ä»¶ï¼ˆå¦‚\
            \ `if x not in [1, 5, 10]`ï¼‰ï¼Œç¡®ä¿æµ‹è¯•è¾“å…¥çš„åˆæ³•æ€§ã€‚ * **Scenario Simulation (åœºæ™¯æ¨¡æ‹Ÿ):**\
            \ åœ¨ç¼–å†™ä»£ç å‰ï¼Œå…ˆåœ¨è„‘æµ·ä¸­è¿è¡Œä¸€éå¾ªç¯é€»è¾‘ï¼Œåˆ¤æ–­ç¬¬äºŒæ¬¡è¿­ä»£æ˜¯å¦éœ€è¦é‡æ–°åˆå§‹åŒ–èµ„æºï¼ˆå¦‚é‡æ–°æŠ•å¸ï¼‰ã€‚\n\n\n\n4. **Write Tests:**\
            \ ç¼–å†™ä¸€ä¸ªç»§æ‰¿è‡ª `unittest.TestCase` çš„ç±»ã€‚\n   - åŒ…å«æ­£å¸¸æƒ…å†µ (Happy Path)ã€‚\n   - åŒ…å«è¾¹ç•Œæƒ…å†µ\
            \ (Edge Cases)ã€‚\n\n# Output Format (JSON)\nè¯·è¾“å‡ºä¸”ä»…è¾“å‡ºä¸€ä¸ª JSON åˆ—è¡¨ï¼Œä»£è¡¨ä½ çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼Œåˆ—è¡¨é‡Œçš„æ¯ä¸ªjson\
            \ objectä»£è¡¨ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ã€‚å³ä½¿ä½ è§‰å¾—åªéœ€è¦ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œä¹Ÿè¦ç”¨jsonåˆ—è¡¨æ¥åŒ…è£…\n\næ ¼å¼è¦æ±‚ï¼š\n[\n  {\n      \"\
            reasoning\": \"### Analytical walkthrough for 'MarkdownParser':\\n\\n1.\
            \ **Logic Flow & Edge Cases:**\\n   - I noticed the `parse_line(text)`\
            \ method behaves differently based on the `in_code_block` boolean flag.\\\
            n   - **Observation:** If `text` starts with '```', it toggles the flag.\
            \ \\n   - **Testing Implication:** I cannot just test a header line (`#\
            \ Title`) in isolation. I must create a test sequence: Open code block\
            \ -> Insert header (should NOT be parsed as header) -> Close code block\
            \ -> Insert header (Should be parsed).\\n\\n2. **Input Validation Constraints:**\\\
            n   - The code specifically checks `if len(text) > 1000: raise ValueError`.\\\
            n   - **Strategy:** My test cases must respect this limit. I will generate\
            \ a string of length 1001 to verify the crash, but for functional tests,\
            \ I must keep inputs short.\\n\\n3. **Hidden Dependencies:**\\n   - The\
            \ `get_html()` output depends on the order of calls. It's an append-only\
            \ buffer.\\n   - **Correction:** I shouldn't assert `get_html()` equals\
            \ a specific string unless I've tracked the exact sequence of previous\
            \ calls. Better to test `assertIn` for specific fragments.\",\n    \"\
            filename\": \"test.py\",\n    \"suffix\": \"py\",\n    \"content\": \"\
            import unittest\\n\\nclass TestSolution(unittest.TestCase):\\n    def\
            \ test_case_1(self):\\n        # ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œæ— éœ€å¯¼å…¥\\n        self.assertEqual(solution(1,\
            \ 2), 3)\",\n    \"type\": \"test\"\n  }\n]\n\nConstraints:\nä¸è¦åŒ…å« Markdown\
            \ ä»£ç å—æ ‡è®°ï¼ˆå¦‚ ```pythonï¼‰ã€‚\nç¡®ä¿ JSON æ ¼å¼åˆæ³•ã€‚\nä¸è¦ä½¿ç”¨ if __name__ == '__main__':ã€‚\n\
            [JSON Formatting Rules]\nNO UNESCAPED QUOTES: If you need to quote something\
            \ inside the reasoning text, use Single Quotes (') or **Backticks ()**.\
            \ Never use Double Quotes (\") inside the JSON value unless they are escaped\
            \ (\"`).\nBad: \"reasoning\": \"I set the value to \"\" empty string\"\
            \nGood: \"reasoning\": \"I set the value to '' empty string\"\nGood: \"\
            reasoning\": \"I set the value to \"\" empty string\""
        - id: 528fe4bd-2f88-40b0-8c79-af53c90543ae
          role: user
          text: '**User Story**: {{#1766666534467.text#}}

            **Source Code**: {{#17667737781900.current_code#}}'
        selected: false
        title: testcase agent
        type: llm
        vision:
          enabled: false
      height: 115
      id: '1766667562386'
      position:
        x: 1365
        y: 201
      positionAbsolute:
        x: 1365
        y: 201
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        outputs:
        - value_selector:
          - '1766681217998'
          - current_code
          value_type: string
          variable: output
        selected: false
        title: è¾“å‡º
        type: end
      height: 87
      id: '1766680328187'
      position:
        x: 5240
        y: 215
      positionAbsolute:
        x: 5240
        y: 215
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        break_conditions: []
        error_handle_mode: terminated
        height: 518
        logical_operator: and
        loop_count: 3
        loop_variables:
        - id: 830d1fc9-96bc-4ba1-b05b-9f2ab4e2cae9
          label: current_code
          value:
          - '17667737781900'
          - current_code
          value_type: variable
          var_type: string
        - id: b69e4f08-ee66-49e7-af2c-4845110025ed
          label: current_testcase
          value:
          - '17668141792250'
          - current_testcase
          value_type: variable
          var_type: string
        selected: false
        start_node_id: 1766681217998start
        title: å¾ªç¯
        type: loop
        width: 3093
      height: 518
      id: '1766681217998'
      position:
        x: 2047
        y: 0
      positionAbsolute:
        x: 2047
        y: 0
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 3093
      zIndex: 1
    - data:
        desc: ''
        isInLoop: true
        selected: false
        title: ''
        type: loop-start
      draggable: false
      height: 48
      id: 1766681217998start
      parentId: '1766681217998'
      position:
        x: 60
        y: 173
      positionAbsolute:
        x: 2107
        y: 173
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-loop-start
      width: 44
      zIndex: 1002
    - data:
        author: Zhuang Keju
        desc: ''
        height: 88
        selected: false
        showAuthor: true
        text: ''
        theme: blue
        title: ''
        type: ''
        width: 240
      height: 88
      id: '1766681921022'
      position:
        x: 878.4648134797859
        y: 615.3529237451298
      positionAbsolute:
        x: 878.4648134797859
        y: 615.3529237451298
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom-note
      width: 240
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 8fe66ca4-5c80-4bf3-a797-56faa5c10819
            value: false
            varType: boolean
            variable_selector:
            - '1766769356726'
            - is_pass
          id: 'true'
          logical_operator: and
        isInLoop: true
        selected: false
        title: æ¡ä»¶åˆ†æ”¯ (1)
        type: if-else
      height: 123
      id: '17666823941251'
      parentId: '1766681217998'
      position:
        x: 1147
        y: 135
      positionAbsolute:
        x: 3194
        y: 135
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        selected: false
        title: é€€å‡ºå¾ªç¯
        type: loop-end
      height: 53
      id: '1766682485472'
      parentId: '1766681217998'
      position:
        x: 1488
        y: 60
      positionAbsolute:
        x: 3535
        y: 60
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom-simple
      width: 244
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: 13d78372-655a-4b59-9419-8b54ed53876c
          role: system
          text: "Role: You are an expert Python Debugger and Code Arbiter.\nGoal:\
            \ Analyze the provided Source Code, Test Case, User Story, and Execution\
            \ Output (Error Logs) to fix the failure.\nDecision Protocol (The Router\
            \ Logic): You must decide which file contains the root cause of the failure.\n\
            High Priority (Fix Source Code): Default behavior. If the logic is wrong,\
            \ the calculation is off, or the output format doesn't match the requirement,\
            \ fix the Source Code.\nLow Priority (Fix Test Case): ONLY fix the Test\
            \ Case if:\nThe test uses specific variable names/function calls that\
            \ do not exist in the source (Hallucination/NameError).\nThe test violates\
            \ strict constraints defined in the `User Story`.\nThe test expectation\
            \ is physically impossible or logically flawed.\nConstraint: Do not change\
            \ the Test Case just to make it pass. Only change it if it is objectively\
            \ wrong.\nFixing Requirements:\nAnalyze: Think deeply about why it failed.\n\
            Minimal Changes: Make only the smallest necessary changes to fix the specific\
            \ error.\nNo Refactoring: Do NOT change the overall architecture or class\
            \ structure.\nConsistency: Keep entry points (function names, class names)\
            \ identical.\nConflict Resolution: If BOTH need fixing, choose to fix\
            \ the TEST CASE first (to establish a correct standard for the next loop).\n\
            \nOutput Format: You must output a SINGLE JSON Object. Do not output Markdown\
            \ blocks outside the JSON.\n\n{\n  \"reasoning\": \"Brief analysis of\
            \ the error. Explicitly state WHY you chose to fix this specific file\
            \ (e.g., 'The test fails because it tries to call a non-existent function\
            \ `add` globally, but the source defines it inside `Addition` class.').\"\
            ,\n  \"target_file\": \"SOURCE\",  // or \"TEST\", only those two.\n \
            \ \"file_content\": \"The FULL content of the fixed file (Source or Test).\"\
            \n}\n\nYou may include simple comments noting what have you fixed in the\
            \ `file_content` field of the JSON, but no extended thinking in comments.\
            \ all thinking should be indicated in the `reasoning` field.\n\nâŒ BAD\
            \ COMMENTS (Strictly Prohibited): Do not write your \"stream of consciousness\"\
            \ or \"thinking process\" in comments.\n# I am thinking maybe I should\
            \ change this loop...\n# Let me try to see if using a stack works better...\n\
            # Wait, this logic might fail for negative numbers, let me reconsider...\n\
            # The previous code was 1+1=3, which is wrong. I am trying to find a way\
            \ to make it 2. Let's try method A...\nâœ… GOOD COMMENTS (Allowed): Write\
            \ comments that explain the outcome or the reason for a specific fix.\n\
            # Fix: Corrected arithmetic logic (1+1=2).\n# Note: This regex handles\
            \ nested brackets.\n# Bugfix: Previously, digits were incorrectly treated\
            \ as multipliers only.\n"
        - id: 0455c727-fe9a-4571-bbcf-b61af2513067
          role: user
          text: '**Source Code**: {{#1766681217998.current_code#}}


            **Test Case**: {{#1766681217998.current_testcase#}}


            **User Story**: {{#1766666534467.text#}}


            **Execution Output**: {{#1766769356726.error_log#}}


            '
        selected: false
        title: Debugging Agent
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1766682500741'
      parentId: '1766681217998'
      position:
        x: 1488
        y: 173
      positionAbsolute:
        x: 3535
        y: 173
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1766771232701'
          - content
          variable_selector:
          - '1766681217998'
          - current_code
          write_mode: over-write
        loop_id: '1766681217998'
        selected: false
        title: å˜é‡èµ‹å€¼
        type: assigner
        version: '2'
      height: 83
      id: '1766682647945'
      parentId: '1766681217998'
      position:
        x: 2471
        y: 302
      positionAbsolute:
        x: 4518
        y: 302
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-325
            key: ''
            type: text
            value: '{{#1766774144559.payload#}}'
          type: json
        headers: Authorization:Bearer {{#env.API_KEY#}}
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: Code Exec API
        type: http-request
        url: https://vercel-code-runner.vercel.app/api/exec
        variables: []
      height: 136
      id: '1766769039651'
      parentId: '1766681217998'
      position:
        x: 505
        y: 129
      positionAbsolute:
        x: 2552
        y: 129
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        code: "import json\n\ndef main(exec_output: str) -> dict:\n    # exec_output\
          \ æ˜¯ HTTP èŠ‚ç‚¹è¾“å‡ºçš„ Body å­—ç¬¦ä¸²\n    try:\n        result = json.loads(exec_output)\n\
          \    except:\n        return {\"is_pass\": False, \"error_log\": \"Vercel\
          \ response parse failed\"}\n\n    # ç›´æ¥è¯»å– Vercel è¿”å›çš„å¸ƒå°”å€¼\n    is_pass = result.get(\"\
          is_pass\", False)\n    \n    # æ„é€ ç»™ Debugger çœ‹çš„é”™è¯¯æ—¥å¿—\n    # å¦‚æœå¤±è´¥ï¼Œé‡ç‚¹å±•ç¤º stderr\
          \ (unittest è¾“å‡º) å’Œ error (å †æ ˆä¿¡æ¯)\n    error_log = \"\"\n    if not is_pass:\n\
          \        error_log = f\"Summary: {result.get('summary')}\\n\"\n        error_log\
          \ += f\"Details:\\n{result.get('stderr')}\\n\"\n        if result.get('error'):\n\
          \             error_log += f\"Traceback:\\n{result.get('error')}\"\n   \
          \ \n    return {\n        \"is_pass\": is_pass,\n        \"error_log\":\
          \ error_log\n    }"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        outputs:
          error_log:
            children: null
            type: string
          is_pass:
            children: null
            type: boolean
        selected: false
        title: QA Judge
        type: code
        variables:
        - value_selector:
          - '1766769039651'
          - body
          value_type: string
          variable: exec_output
      height: 51
      id: '1766769356726'
      parentId: '1766681217998'
      position:
        x: 826
        y: 171
      positionAbsolute:
        x: 2873
        y: 171
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        code: "import re\nimport json\n\n\n\ndef safe_json_decode(raw_str):\n    \"\
          \"\"å°è¯•å°†æå–å‡ºçš„åŸå§‹å­—ç¬¦ä¸²(åŒ…å«è½¬ä¹‰ç¬¦)è½¬æ¢ä¸ºçœŸå®å­—ç¬¦ä¸²\"\"\"\n    try:\n        # åŠ ä¸Šå¼•å·å‡è£…å®ƒæ˜¯ç‹¬ç«‹çš„ JSON\
          \ å­—ç¬¦ä¸²\n        return json.loads(f'\"{raw_str}\"')\n    except:\n      \
          \  return raw_str\n\n\ndef remove_trailing_slash(content):\n    # === âœ‚ï¸\
          \ æ ¸å¿ƒæ¸…æ´—åŒº Start ===\n    \n    # 1. ç§»é™¤é¦–å°¾ç©ºç™½\n    content = content.strip()\n\
          \    \n    # 2. \U0001F525 æš´åŠ›ç§»é™¤æœ«å°¾çš„åƒåœ¾å­—ç¬¦ /n æˆ– \\n \n    # æœ‰æ—¶å€™æ¨¡å‹ä¼šé‡å¤å†™å¥½å‡ ä¸ªï¼Œæ‰€ä»¥ç”¨\
          \ while å¾ªç¯åˆ å¹²å‡€\n    while content.endswith(\"/n\") or content.endswith(\"\
          \\\\n\"):\n        if content.endswith(\"/n\"):\n            content = content[:-2]\n\
          \        elif content.endswith(\"\\\\n\"):\n            content = content[:-2]\n\
          \    \n    # 3. å†æ¬¡ç§»é™¤å¯èƒ½å‰©ä¸‹çš„ç©ºç™½\n    content = content.strip()\n    return content\n\
          \n\n\ndef regex_decode(text):\n    pair_pattern = (\n        r'\"target_file\"\
          \\s*:\\s*\"(.*?)(?<!\\\\)\"'   # Group 1: target_file (SOURCE æˆ– TEST)\n\
          \        r'.*?'                                  # å¿½ç•¥ä¸­é—´çš„æ‚éŸ³ (éè´ªå©ªåŒ¹é…)\n   \
          \     r'\"file_content\"\\s*:\\s*\"(.*?)(?<!\\\\)\"'  # Group 2: file_content\
          \ (ä»£ç å†…å®¹)\n    )    \n\n    match = re.search(pair_pattern, text, re.DOTALL)\n\
          \    \n    if match:\n        # 1. æå–åŸå§‹å­—ç¬¦ä¸² (Raw String)\n        raw_target\
          \ = match.group(1)\n        raw_content = match.group(2)\n        \n   \
          \     # 2. è§£ç è½¬ä¹‰å­—ç¬¦\n        target = safe_json_decode(raw_target)\n     \
          \   content = safe_json_decode(raw_content)\n        \n        # 3. äºŒæ¬¡æ¸…æ´—å†…å®¹\
          \ (å»é™¤æœ«å°¾å¯èƒ½çš„ /n)\n        content = remove_trailing_slash(content)\n     \
          \   \n        # 4. è¿”å›å­—å…¸\n        return {\n            \"target\": target,\n\
          \            \"content\": content\n        }\n\n\n\ndef main(llm_output:\
          \ str) -> dict:\n    code = llm_output.strip()\n    \n    # ----------------------------------------\n\
          \    # 1. å°è¯•å‰¥ç¦» Markdown (```python ... ```)\n    # ----------------------------------------\n\
          \    # è¿™é‡Œçš„æ­£åˆ™è§£é‡Šï¼š\n    # ```             -> åŒ¹é…å¼€å¤´åå¼•å·\n    # (?:python|json)?\
          \ -> å¯é€‰çš„è¯­è¨€æ ‡è®° (python æˆ– json)ï¼Œ?:è¡¨ç¤ºä¸æ•è·\n    # \\s* -> åƒæ‰æ¢è¡Œç¬¦\n    # (.*?) \
          \          -> æ ¸å¿ƒæ•è·ç»„ï¼šæå–ä¸­é—´çš„æ‰€æœ‰ä»£ç  (éè´ªå©ª)\n    # ```             -> åŒ¹é…ç»“å°¾åå¼•å·\n\
          \    # re.DOTALL       -> è®©ç‚¹å·(.)å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦ï¼Œè¿™å¾ˆå…³é”®ï¼\n    pattern = r\"```(?:python|json)?\\\
          s*(.*?)```\"\n    match = re.search(pattern, code, re.DOTALL | re.IGNORECASE)\n\
          \    \n    if match:\n        code = match.group(1).strip()\n    \n    #\
          \ ----------------------------------------\n    # 2. å¦‚æœè¿™æœ¬èº«æ˜¯ä¸€æ®µ JSON å­—ç¬¦ä¸²ï¼ˆæœ‰æ—¶å€™\
          \ LLM ä¼šæŠŠ JSON åŒ…åœ¨ Markdown é‡Œï¼‰\n    #    æˆ‘ä»¬éœ€è¦æŠŠå®ƒè§£å¼€ï¼Œåªæ‹¿é‡Œé¢çš„ code å­—æ®µ\n    # ----------------------------------------\n\
          \n    # æˆ‘è§‰å¾—è¿™ä¸€æ®µå¯ä»¥æ³¨é‡Šæ‰\n    try:\n        # å°è¯•è§£æ JSON\n        data = json.loads(code)\n\
          \        if isinstance(data, dict) and \"code\" in data:\n            code\
          \ = data[\"code\"]\n    except json.JSONDecodeError:\n        # å¦‚æœä¸æ˜¯ JSONï¼Œé‚£è¯´æ˜å‰¥ç¦»\
          \ Markdown åå°±æ˜¯çº¯ Python ä»£ç äº†ï¼Œä¸åšå¤„ç†\n        pass\n\n    # http_body_struct\
          \ = {\n    #     \"code\": code\n    # }\n    # pythonæ‰“åŒ…jsonï¼Œä¸ç”¨difyæ‰“åŒ…\n\n\
          \    try:\n        update = json.loads(code)\n    except:\n        update\
          \ = regex_decode(code)\n        return update\n\n    return {\n        #\
          \ \"payload\": json.dumps(http_body_struct) ,\n        # è¾“å‡ºå˜æˆäº†å­—ç¬¦ä¸²ï¼š{\"code\"\
          : \"def ...\"}\n        \"target\": update[\"target_file\"],\n        \"\
          content\": update[\"file_content\"]\n\n    }"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        outputs:
          content:
            children: null
            type: string
          target:
            children: null
            type: string
        selected: false
        title: Code Cleaner
        type: code
        variables:
        - value_selector:
          - '1766682500741'
          - text
          value_type: string
          variable: llm_output
      height: 51
      id: '1766771232701'
      parentId: '1766681217998'
      position:
        x: 1809
        y: 191
      positionAbsolute:
        x: 3856
        y: 191
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        code: "import re\nimport json\n\ndef main(llm_output: str) -> dict:\n    code\
          \ = llm_output.strip()\n    \n    # ----------------------------------------\n\
          \    # 1. å°è¯•å‰¥ç¦» Markdown (```python ... ```)\n    # ----------------------------------------\n\
          \    # è¿™é‡Œçš„æ­£åˆ™è§£é‡Šï¼š\n    # ```             -> åŒ¹é…å¼€å¤´åå¼•å·\n    # (?:python|json)?\
          \ -> å¯é€‰çš„è¯­è¨€æ ‡è®° (python æˆ– json)ï¼Œ?:è¡¨ç¤ºä¸æ•è·\n    # \\s* -> åƒæ‰æ¢è¡Œç¬¦\n    # (.*?) \
          \          -> æ ¸å¿ƒæ•è·ç»„ï¼šæå–ä¸­é—´çš„æ‰€æœ‰ä»£ç  (éè´ªå©ª)\n    # ```             -> åŒ¹é…ç»“å°¾åå¼•å·\n\
          \    # re.DOTALL       -> è®©ç‚¹å·(.)å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦ï¼Œè¿™å¾ˆå…³é”®ï¼\n    pattern = r\"```(?:python|json)?\\\
          s*(.*?)```\"\n    match = re.search(pattern, code, re.DOTALL | re.IGNORECASE)\n\
          \    \n    if match:\n        code = match.group(1).strip()\n    code =\
          \ code.strip(\"`\")\n    # ----------------------------------------\n  \
          \  # 2. å¦‚æœè¿™æœ¬èº«æ˜¯ä¸€æ®µ JSON å­—ç¬¦ä¸²ï¼ˆæœ‰æ—¶å€™ LLM ä¼šæŠŠ JSON åŒ…åœ¨ Markdown é‡Œï¼‰\n    #    æˆ‘ä»¬éœ€è¦æŠŠå®ƒè§£å¼€ï¼Œåªæ‹¿é‡Œé¢çš„\
          \ code å­—æ®µ\n    # ----------------------------------------\n\n    # æˆ‘è§‰å¾—è¿™ä¸€æ®µå¯ä»¥æ³¨é‡Šæ‰\n\
          \    try:\n        # å°è¯•è§£æ JSON\n        data = json.loads(code)\n      \
          \  if isinstance(data, dict) and \"code\" in data:\n            code = data[\"\
          code\"]\n    except json.JSONDecodeError:\n        # å¦‚æœä¸æ˜¯ JSONï¼Œé‚£è¯´æ˜å‰¥ç¦» Markdown\
          \ åå°±æ˜¯çº¯ Python ä»£ç äº†ï¼Œä¸åšå¤„ç†\n        pass\n\n    http_body_struct = {\n     \
          \   \"code\": code\n    }\n    # pythonæ‰“åŒ…jsonï¼Œä¸ç”¨difyæ‰“åŒ…\n    return {\n \
          \       \"current_code\": code\n\n    }"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        outputs:
          current_code:
            children: null
            type: string
        selected: false
        title: Code Cleaner (1)
        type: code
        variables:
        - value_selector:
          - '1766666714696'
          - text
          value_type: string
          variable: llm_output
      height: 51
      id: '17667737781900'
      position:
        x: 1024
        y: 233
      positionAbsolute:
        x: 1024
        y: 233
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        code: "import json\n\ndef main(current_code: str, current_testcase: str) ->\
          \ dict:\n    # æ„é€  Payload å­—å…¸\n    # è¿™é‡Œå¯ä»¥æ‰©å±•ï¼šå¦‚æœä½ ä»¥åæƒ³ä¼  test_casesï¼Œä¹Ÿå¯ä»¥åŠ åœ¨è¿™é‡Œ\n\
          \    assert current_testcase is not None\n    payload_dict = {\n       \
          \ \"code\": current_code,\n        \"test\": current_testcase\n    }\n \
          \   \n    return {\n        \"payload\": json.dumps(payload_dict)\n    }"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        outputs:
          payload:
            children: null
            type: string
        selected: false
        title: payload parser
        type: code
        variables:
        - value_selector:
          - '1766681217998'
          - current_code
          value_type: string
          variable: current_code
        - value_selector:
          - '1766681217998'
          - current_testcase
          value_type: string
          variable: current_testcase
      height: 51
      id: '1766774144559'
      parentId: '1766681217998'
      position:
        x: 184
        y: 171
      positionAbsolute:
        x: 2231
        y: 171
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        code: "import re\nimport json\n\ndef safe_json_decode(raw_str):\n    \"\"\"\
          å°è¯•å°†æå–å‡ºçš„åŸå§‹å­—ç¬¦ä¸²(åŒ…å«è½¬ä¹‰ç¬¦)è½¬æ¢ä¸ºçœŸå®å­—ç¬¦ä¸²\"\"\"\n    try:\n        # åŠ ä¸Šå¼•å·å‡è£…å®ƒæ˜¯ç‹¬ç«‹çš„ JSON\
          \ å­—ç¬¦ä¸²\n        return json.loads(f'\"{raw_str}\"')\n    except:\n      \
          \  return raw_str\n\n\ndef remove_trailing_slash(content):\n    # === âœ‚ï¸\
          \ æ ¸å¿ƒæ¸…æ´—åŒº Start ===\n    \n    # 1. ç§»é™¤é¦–å°¾ç©ºç™½\n    content = content.strip()\n\
          \    \n    # 2. \U0001F525 æš´åŠ›ç§»é™¤æœ«å°¾çš„åƒåœ¾å­—ç¬¦ /n æˆ– \\n \n    # æœ‰æ—¶å€™æ¨¡å‹ä¼šé‡å¤å†™å¥½å‡ ä¸ªï¼Œæ‰€ä»¥ç”¨\
          \ while å¾ªç¯åˆ å¹²å‡€\n    while content.endswith(\"/n\") or content.endswith(\"\
          \\\\n\"):\n        if content.endswith(\"/n\"):\n            content = content[:-2]\n\
          \        elif content.endswith(\"\\\\n\"):\n            content = content[:-2]\n\
          \    \n    # 3. å†æ¬¡ç§»é™¤å¯èƒ½å‰©ä¸‹çš„ç©ºç™½\n    content = content.strip()\n    return content\n\
          \ndef regex_decode(text):\n    triplet_pattern = (\n        r'\"filename\"\
          \\s*:\\s*\"(.*?)(?<!\\\\)\"'  # Group 1: filename\n        r'.*?'      \
          \                        # Skip garbage\n        r'\"suffix\"\\s*:\\s*\"\
          (.*?)(?<!\\\\)\"'    # Group 2: suffix\n        r'.*?'                 \
          \             # Skip garbage\n        r'\"content\"\\s*:\\s*\"(.*?)(?<!\\\
          \\)\"'   # Group 3: content\n    )\n    \n    matches = re.finditer(triplet_pattern,\
          \ text, re.DOTALL)\n    \n    final_code = \"\"\n    found_any = False\n\
          \    \n    for match in matches:\n        found_any = True\n        \n \
          \       # æå– raw string\n        raw_fname = match.group(1)\n        raw_suffix\
          \ = match.group(2)\n        raw_content = match.group(3)\n        \n   \
          \     # è§£ç è½¬ä¹‰å­—ç¬¦ (å¤„ç† \\n, \\\", \\t ç­‰)\n        fname = safe_json_decode(raw_fname)\n\
          \        suffix = safe_json_decode(raw_suffix)\n        content = safe_json_decode(raw_content)\n\
          \        \n        # äºŒæ¬¡æ¸…æ´—ä»£ç å†…å®¹\n        content = remove_trailing_slash(content)\n\
          \        \n        # æ‹¼æ¥\n        # final_code += f\"# File: {fname} (Type:\
          \ {suffix})\\n\"\n        if suffix == \"py\":\n            final_code +=\
          \ content + \"\\n\\n\"\n    return final_code.strip()\n    # if not found_any:\n\
          \        ## å¦‚æœå½»åº•åŒ¹é…å¤±è´¥ï¼Œè¿”å›åŸæ–‡æœ¬ä»¥ä¾¿è°ƒè¯•\n        # return {\"current_testcase\":\
          \ \"# EXTRACTION FAILED\\n\" + text}\n\n\n\n\ndef main(llm_output: str)\
          \ -> dict:\n    code = llm_output.strip()\n    \n    # ----------------------------------------\n\
          \    # 1. å°è¯•å‰¥ç¦» Markdown (```python ... ```)\n    # ----------------------------------------\n\
          \    # è¿™é‡Œçš„æ­£åˆ™è§£é‡Šï¼š\n    # ```             -> åŒ¹é…å¼€å¤´åå¼•å·\n    # (?:python|json)?\
          \ -> å¯é€‰çš„è¯­è¨€æ ‡è®° (python æˆ– json)ï¼Œ?:è¡¨ç¤ºä¸æ•è·\n    # \\s* -> åƒæ‰æ¢è¡Œç¬¦\n    # (.*?) \
          \          -> æ ¸å¿ƒæ•è·ç»„ï¼šæå–ä¸­é—´çš„æ‰€æœ‰ä»£ç  (éè´ªå©ª)\n    # ```             -> åŒ¹é…ç»“å°¾åå¼•å·\n\
          \    # re.DOTALL       -> è®©ç‚¹å·(.)å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦ï¼Œè¿™å¾ˆå…³é”®ï¼\n    pattern = r\"```(?:python|json)?\\\
          s*(.*?)```\"\n    match = re.search(pattern, code, re.DOTALL | re.IGNORECASE)\n\
          \    \n    if match:\n        code = match.group(1).strip()\n    \n    #\
          \ ----------------------------------------\n    # 2. å¦‚æœè¿™æœ¬èº«æ˜¯ä¸€æ®µ JSON å­—ç¬¦ä¸²ï¼ˆæœ‰æ—¶å€™\
          \ LLM ä¼šæŠŠ JSON åŒ…åœ¨ Markdown é‡Œï¼‰\n    #    æˆ‘ä»¬éœ€è¦æŠŠå®ƒè§£å¼€ï¼Œåªæ‹¿é‡Œé¢çš„ code å­—æ®µ\n    # ----------------------------------------\n\
          \n    # æˆ‘è§‰å¾—è¿™ä¸€æ®µå¯ä»¥æ³¨é‡Šæ‰\n    try:\n        # å°è¯•è§£æ JSON\n        data = json.loads(code)\n\
          \        if isinstance(data, dict) and \"code\" in data:\n            code\
          \ = data[\"code\"]\n    except json.JSONDecodeError:\n        # å¦‚æœä¸æ˜¯ JSONï¼Œé‚£è¯´æ˜å‰¥ç¦»\
          \ Markdown åå°±æ˜¯çº¯ Python ä»£ç äº†ï¼Œä¸åšå¤„ç†\n        pass\n    try:\n        code =\
          \ json.loads(code)\n    except:\n        regex_decode_result = regex_decode(code)\n\
          \        return {\"current_testcase\":\n        regex_decode_result}\n\n\
          \    if isinstance(code, dict):\n        code = [code]\n    code_extracted\
          \ = \"\"\n    for obj in code:\n        if obj[\"suffix\"] == \"py\":\n\
          \            obj_code = obj[\"content\"]\n            obj_code = remove_trailing_slash(obj_code)\n\
          \            code_extracted += obj_code + \"\\n\"\n\n    # pythonæ‰“åŒ…jsonï¼Œä¸ç”¨difyæ‰“åŒ…\n\
          \    return {\n        \"current_testcase\": code_extracted\n\n    }"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        outputs:
          current_testcase:
            children: null
            type: string
        selected: false
        title: Code Cleaner (2)
        type: code
        variables:
        - value_selector:
          - '1766667562386'
          - text
          value_type: string
          variable: llm_output
      height: 51
      id: '17668141792250'
      position:
        x: 1706
        y: 233
      positionAbsolute:
        x: 1706
        y: 233
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: fb5e66af-2bc5-44e0-a486-418932ff5179
            value: SOURCE
            varType: string
            variable_selector:
            - '1766771232701'
            - target
          id: 'true'
          logical_operator: and
        - case_id: 7cb1c443-958a-4cbf-b56a-1f5fc8844281
          conditions:
          - comparison_operator: is
            id: 3d7fac5d-c700-496b-9ac0-77ecce05f7d7
            value: TEST
            varType: string
            variable_selector:
            - '1766771232701'
            - target
          logical_operator: and
        isInIteration: false
        isInLoop: true
        loop_id: '1766681217998'
        selected: false
        title: æ¡ä»¶åˆ†æ”¯ 2
        type: if-else
      height: 171
      id: '1766973272745'
      parentId: '1766681217998'
      position:
        x: 2130
        y: 131
      positionAbsolute:
        x: 4177
        y: 131
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1766771232701'
          - content
          variable_selector:
          - '1766681217998'
          - current_testcase
          write_mode: over-write
        loop_id: '1766681217998'
        selected: false
        title: å˜é‡èµ‹å€¼ 2
        type: assigner
        version: '2'
      height: 83
      id: '1766973466943'
      parentId: '1766681217998'
      position:
        x: 2471
        y: 133
      positionAbsolute:
        x: 4518
        y: 133
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
      zIndex: 1002
    viewport:
      x: -1411.900961471774
      y: 196.5566824682303
      zoom: 0.5352673998912678
  rag_pipeline_variables: []
